---
title: ROS2 (Robot Operating System)
author: Yeon Gyu Yang
date: 2025-02-01 00:00:00 +0800
categories: [Ros2]
tags: [ros]
math: true
toc: true
mermaid: true
description: >-
  ROS2에 대해 알아보자
image:
  path: "https://blog.kakaocdn.net/dn/bQNsqg/btsmRqch9FW/vkA2Ju2zs5t2GGxcYA9JU0/img.png"
  alt: "Github Pages 예제 이미지"

---

## How to Install ROS2 (Humble or Jassy)
WSL Ubuntu 24에서 Humble의 경우 repo list에서 지원하지 않아 Jassy로 설치하여 진행함
- Humble : [link](https://docs.ros.org/en/humble/Installation/Ubuntu-Install-Debs.html)
- Jazzy : [link](https://docs.ros.org/en/jazzy/Installation/Ubuntu-Install-Debs.html)

+ rqt_graph로 현재 실행중인 노드 및 발행된 topic 정보 확인 가능
<img src="/assets/img/post/ros/1.png">

---

## ROS2 특징
- `setup.sh`
  - sudo apt install 명령으로 설치한 ros pkg들이 저장된 곳이 /opt/ros/[Version, ex.huble/jassyh]이며, 해당 경로의 setup.bash를 sourc로 읽어 들여야 ros2 개발환경 사용이 가능
- `ROS_DOMAIN_ID`
  - `DDS(Data Distribution Service, 데이터 분산 서비스)`을 재택하여 시스템의 실시간성/규모가변성/안정성/고성능을 가능케 하도록 Publish/Subscribe 네트워크 커뮤니케이션 구조의 미들웨어를 사용함
  - 따라서 다른 네트워크에서 들어오는 정보를 구분 짓기 위해 `ROS_DOMAIN_ID`라는 시스템 변수를 사용함

## ROS 구조
### Node : 
  - 실행가능한 최소 단위를 말함
  - 노드확인 명령어 : `ros2 run <PKG Name> <Node Name>`
    - ex.  ros2 run turtlesim turtlesim_node
  - 그외 명령어
    `ros2 node list` : 실행중인 노드 리스트 확인 가능
    `ros2 node info turtlesim` : 현재 실행중인 노드의 정보를 출력


```bash
gyyeon@DESKTOP-A9M7R8S:~$ ros2 node list # 현재 실행중인 노드 리스트 확인
/turtlesim
gyyeon@DESKTOP-A9M7R8S:~$ ros2 node info /turtlesim # 이 노드가 어떤것을 제공하는지 확인 가능
/turtlesim
  Subscribers:
    /parameter_events: rcl_interfaces/msg/ParameterEvent
    /turtle1/cmd_vel: geometry_msgs/msg/Twist
  Publishers:
    /parameter_events: rcl_interfaces/msg/ParameterEvent
    /rosout: rcl_interfaces/msg/Log
    /turtle1/color_sensor: turtlesim/msg/Color
    /turtle1/pose: turtlesim/msg/Pose
  Service Servers:
    /clear: std_srvs/srv/Empty
    /kill: turtlesim/srv/Kill
    /reset: std_srvs/srv/Empty
    /spawn: turtlesim/srv/Spawn
    /turtle1/set_pen: turtlesim/srv/SetPen
    /turtle1/teleport_absolute: turtlesim/srv/TeleportAbsolute
    /turtle1/teleport_relative: turtlesim/srv/TeleportRelative
    /turtlesim/describe_parameters: rcl_interfaces/srv/DescribeParameters
    /turtlesim/get_parameter_types: rcl_interfaces/srv/GetParameterTypes
    /turtlesim/get_parameters: rcl_interfaces/srv/GetParameters
    /turtlesim/get_type_description: type_description_interfaces/srv/GetTypeDescription
    /turtlesim/list_parameters: rcl_interfaces/srv/ListParameters
    /turtlesim/set_parameters: rcl_interfaces/srv/SetParameters
    /turtlesim/set_parameters_atomically: rcl_interfaces/srv/SetParametersAtomically
  Service Clients:

  Action Servers:
    /turtle1/rotate_absolute: turtlesim/action/RotateAbsolute
  Action Clients:
```



### Service
 - 클라이언트가 요청한 것을 서버측이 받아 응답하는 것을 말하며, 주고받는 Request/Response에 타입을 지정하여 사용함.
- Service Type Definition의 경우 `---`를 기준으로 위 = Request/아래 = Response에 대한 타입을 정의하며 파일 포맷은 srv(service의 약어)이다.
<img src="/assets//img/post/ros/3.png" width=500 height=400>

- 서비스 확인 명령어 : `ros2 service list`
- 그외 명령어
  - `ros2 service type <서비스>` : 제공하는 서비스의 타입 파일(srv) 경로 확인
    - ex. ros2 service type /turtle1/teleport_absolute 
  - `ros2 interface show <srv 경로>` : 정의된 서비스 타입 파일의 정보 확인
    - ex. ros2 interface show /turtle1/teleport_absolute


```bash
gyyeon@DESKTOP-A9M7R8S:~$ ros2 service list
/clear
/kill
/reset
/spawn
/turtle1/set_pen
/turtle1/teleport_absolute
/turtle1/teleport_relative
/turtlesim/describe_parameters
/turtlesim/get_parameter_types
/turtlesim/get_parameters
/turtlesim/get_type_description
/turtlesim/list_parameters
/turtlesim/set_parameters
/turtlesim/set_parameters_atomically
# 서비스 타입 파일 확인
gyyeon@DESKTOP-A9M7R8S:~$ ros2 service type /turtle1/teleport_absolute
turtlesim/srv/TeleportAbsolute
# srv의 서비스 타입 정보 확인(--- 기준 위는 request, 밑은 response)
gyyeon@DESKTOP-A9M7R8S:~$ ros2 interface show turtlesim/srv/TeleportAbsolute
float32 x
float32 y
float32 theta
---
```

> ros에서 제공하는 서비스 타입의 경우 단위는 `KMS`, `radian`을 주로 사용한다
{: .prompt-info }


#### Service Call
- 제공하는 서비스에 대해 사용 요청하는 `서비스 콜` 명령어에 대해 알아보자
- 서비스 콜 명령어 : `ros2 service call '서비스타입(srv) "data"`
  -ex. 
    - ros2 service call /turtle1/teleport_absolute turtlesim/srv/TeleportAbsolute "{x: 2, y: 2, theta: 1.57}"
    - ros2 service call /reset std_srvs/srv/Empty {}

#### Service Call(Name Space)
- 어떤 로봇인지 구분하기 위해 Name Space를 사용하며 `ros2 service list`를 쳐보면 확인 가능



```bash
# 임의의 터틀봇 생성
gyyeon@DESKTOP-A9M7R8S:~$ ros2 service call /spawn turtlesim/srv/Spawn "{x: 3, y: 5, theta: 3.14, name: ''}"
requester: making request: turtlesim.srv.Spawn_Request(x=3.0, y=5.0, theta=3.14, name='')
response:
turtlesim.srv.Spawn_Response(name='turtle2')
# 터틀봇 서비스 리스트 정보를 확인해보면 turtle1/2 namespace로 개별 동작 서비스가 나눠져 있음이 확인 가능
gyyeon@DESKTOP-A9M7R8S:~$ ros2 service list
/clear
/kill
/reset
/spawn
/turtle1/set_pen              #<------
/turtle1/teleport_absolute    #<------
/turtle1/teleport_relative    #<------
/turtle2/set_pen              #>------
/turtle2/teleport_absolute    #>------
/turtle2/teleport_relative    #>------
/turtlesim/describe_parameters
/turtlesim/get_parameter_types
/turtlesim/get_parameters
/turtlesim/get_type_description
/turtlesim/list_parameters
/turtlesim/set_parameters
/turtlesim/set_parameters_atomically


```

### TOPIC
- Publisher측에서 brodcast로 특정 Topic으로 정보를 제공할때 사용되며,
- Subscriber측은 Topic Name/Message Type을 알면 어느 노드건 해당 메세지를 받아 볼수 있음
- 토픽 리스트 확인 명령어 : `ros2 topic list [-t|-v, 토픽 메시지 타입까지 표여줌| pub,sub 정보를 다보여줌]`
- 토픽 확인 명령어 : `ros2 topic echo [토픽]` (ex. ros2 topic echo /turtle1/pose)
  - 그외 명령어
    - `ros2 topic type [토픽]` : 토픽의 메세지 타입 파일 확인
      -ex. ros2 topic type /turtle1/pose
    - `ros2 topic info [토픽]` : 토픽 타입 및 pub/sub 갯수 확인 가능(ex. subscription cnt:0이라면 아무도 안듣고 있는 상황)
    - `ros2 interface show <토픽 Msg 타입> : 토픽 Msg 타입 정보 확인`
      -ex. ros2 interface show turtlesim/msg/Pose

<img src="https://docs.ros.org/en/humble/_images/Nodes-TopicandService.gif">



```bash
# [default] 토픽 정보 확인
gyyeon@DESKTOP-A9M7R8S:~$ ros2 topic list
/rosout
/turtle1/cmd_vel
/turtle1/color_sensor
/turtle1/pose
/turtle2/cmd_vel
/turtle2/color_sensor
/turtle2/pose
/turtle3/cmd_vel
/turtle3/color_sensor
/turtle3/pose
# [t] 토픽 정보를 토픽 타입 파일과 함께 확인
gyyeon@DESKTOP-A9M7R8S:~$ ros2 topic list -t
/parameter_events [rcl_interfaces/msg/ParameterEvent]
/rosout [rcl_interfaces/msg/Log]
/turtle1/cmd_vel [geometry_msgs/msg/Twist]
/turtle1/color_sensor [turtlesim/msg/Color]
/turtle1/pose [turtlesim/msg/Pose]
/turtle2/cmd_vel [geometry_msgs/msg/Twist]
/turtle2/color_sensor [turtlesim/msg/Color]
/turtle2/pose [turtlesim/msg/Pose]
/turtle3/cmd_vel [geometry_msgs/msg/Twist]
/turtle3/color_sensor [turtlesim/msg/Color]
/turtle3/pose [turtlesim/msg/Pose]
# [v] 토픽 세부 정보 확인
gyyeon@DESKTOP-A9M7R8S:~$ ros2 topic list -v
Published topics:
 * /parameter_events [rcl_interfaces/msg/ParameterEvent] 2 publishers
 * /rosout [rcl_interfaces/msg/Log] 2 publishers
 * /turtle1/color_sensor [turtlesim/msg/Color] 1 publisher
 * /turtle1/pose [turtlesim/msg/Pose] 1 publisher
 * /turtle2/color_sensor [turtlesim/msg/Color] 1 publisher
 * /turtle2/pose [turtlesim/msg/Pose] 1 publisher
 * /turtle3/color_sensor [turtlesim/msg/Color] 1 publisher
 * /turtle3/pose [turtlesim/msg/Pose] 1 publisher

Subscribed topics:
 * /parameter_events [rcl_interfaces/msg/ParameterEvent] 2 subscribers
 * /turtle1/cmd_vel [geometry_msgs/msg/Twist] 1 subscriber
 * /turtle2/cmd_vel [geometry_msgs/msg/Twist] 1 subscriber
 * /turtle3/cmd_vel [geometry_msgs/msg/Twist] 1 subscriber

# 토픽 타입 파일 정보 확인
gyyeon@DESKTOP-A9M7R8S:~$ ros2 interface show turtlesim/msg/
Pose
float32 x
float32 y
float32 theta 

float32 linear_velocity
float32 angular_velocity
```


---
